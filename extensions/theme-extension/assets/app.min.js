window.onload=()=>{function e(t,n,a=!1){t&&t.length>0&&$(`.${n}`).each((function(){const n=$(this).attr("id");let s="<table class='table'>",d="<tr><th></th><th>Referee (New member) Tasks</th><th>Awards</th>";"reward_only"===n&&(d="<tr><th></th><th>Tasks</th><th>Awards</th>"),s+=d,s+=a?"<th>Get</th></tr>":"</tr>",t.forEach((t=>{t.rules.forEach(((n,d)=>{s+="<tr>";let c=ebix_referral_img3;"Register"===n.attribute_operation?c=ebix_referral_img1:"visit_page"===n.attribute_operation&&(c=ebix_referral_img2),s+=`<td><img src="${c}" width="26" alt="${n.attribute_operation}"/></td>`,s+=`<td>${n.task}</td>`,0===d&&(s+=`<td rowspan="${t.rules.length}">${t.award}</td>`,a&&(n.is_rule_passed?s+=`<td rowspan="${t.rules.length}" style="font-size: 2rem;color: green;">âœ“</td>`:n.expiry_status?s+=`<td rowspan="${t.rules.length}" style="color: red;">${n.expiry_date} Expired</td>`:s+=`<td rowspan="${t.rules.length}">${n.expiry_date}</td>`)),s+="</tr>"}))})),s+="</table>",$(this).html(s)}));const s=$(".ebix-modal #specific-link");s.append("<svg fill='currentColor' style='margin-left: 3px' width='15' height='15' viewBox='0 0 15 15' xmlns='http://www.w3.org/2000/svg'><path d='M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z' fill='currentColor' fill-rule='evenodd' clip-rule='evenodd'></path></svg>"),s.click((function(){let t=$(this).attr("ref-id"),n=$(this).attr("ref-rule-id"),a=$(this).attr("href"),s=$(this).html();if($(this).html("Loading..."),n&&t){const d=JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,ref_row_id:t,ref_rule_id:n});fetch("/apps/shopify/referral_visit",{method:"POST",body:d,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((t=>t.json())).then((t=>{$(this).html(s),window.location.href=a})).catch((t=>{$(this).html(s),window.location.href=a}))}}))}const t=EventTarget.prototype.dispatchEvent;function o(t){!function(){const t=window.location.pathname.match(/^\/products\/([\w-]+)/);t&&t[1]}();const n=document.querySelector('form[action^="/cart/add"] input[name="id"]'),a=(n?n.value:null)||t;if(!ebix_Promotion.ShopId)return;const s=JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,variant_id:a});fetch("/apps/shopify/get_special_price",{method:"POST",body:s,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((t=>t.json())).then((t=>{const n=t?.data?.data;Array.isArray(n)&&n.length>0?(n.forEach((t=>{const n=t?.eff?.variants?.[0]?.discount_price,a=parseFloat(t?.eff?.variants?.[0]?.unit_price||0).toFixed(2);$("#spl-price").text(n),$("#unit-price").text(a)})),$("#custom-offer-widget").css("display","block")):$("#custom-offer-widget").css("display","none")})).catch((t=>{console.error("Error fetching special price:",t),$("#custom-offer-widget").css("display","none")}))}function i(t){var n=$(t).text();navigator.clipboard.writeText(n)}EventTarget.prototype.dispatchEvent=function(n){const a=t.call(this,n),s=document.querySelectorAll('form[action^="/cart/add"] input[name="id"]'),d=s[s.length-1];return d&&o(d.value),a},o(),$("#ebix-referral-card").hide(),$("#ebix-join-referral").hide(),$("#ebix-redeem-point").hide(),function(t){let n="ebix-embeded-closed=",a=decodeURIComponent(document.cookie).split(";");for(let t=0;t<a.length;t++){let s=a[t];for(;" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(n))return s.substring(20,s.length)}return""}()?$("#ebix-embeded-btn").css("display","none"):"undefined"!=typeof ebix_Promotion&&ebix_Promotion.ShopId&&function r(){ebix_Promotion.ShopId&&fetch("/apps/shopify/loyalty",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((t=>t.json())).then((t=>{if(t.data){const n=t.data;n.membership&&$("#ebix-tier").text(n.membership.name||"-"),$("#ebix-points").text(n.active_pts||0),n.reward&&($("#ebix-loyalty-card").css("display","block"),$("#ebix-reward").html(`${n.currency} ${n.reward.amount} = ${n.reward.points} Point`)),n.redeem&&($("#ebix-loyalty-card").css("display","block"),$("#ebix-redeem").html(`${n.redeem.points} Point = ${n.currency} ${n.redeem.amount}`)),n.redeem&&n.redeem.max_pts&&(n.redeem&&($("#ebix-max-point").text(n.redeem.max_pts||0),$("#ebix-redeem-coupon").text(n.redeem_code||"")),$("#ebix-redeem-point").show(),$("#total-redeemable").text(`(${n.currency} ${n.redeem.amount/n.redeem.points*n.redeem?.max_pts})`)),$("#ebix-pro-ref-code").text(n.invite_code||""),$("#refer-friend #facebook").attr("href",encodeURI(`https://www.facebook.com/sharer/sharer.php?u=${window.shopUrl}&t=Register and use this code: ${n.invite_code}`)),$("#refer-friend #email").click((t=>{var n=prompt("Enter invitation emails:");n=n.split(",").map((t=>t.trim())),$("#ebix-email-err").text("");var a=0;n.forEach((t=>{(function(t){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(t)})(t)||($("#ebix-email-err").append(`<p style="color:red">${t}: Invalid email.</p>`),a++)})),0==a&&fetch("/apps/shopify/email_invite",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,emails:n}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((t=>t.json())).then((t=>{t.data&&(t.data.already_invited_emails&&t.data.already_invited_emails.length>0?$("#ebix-email-err").append(`<p style="color:red">${t.data.already_invited_emails.join(",")} ${t.msg}</p>`):$("#ebix-email-err").append(`<p style="color:green">${t.msg}</p>`)),setTimeout((()=>{$("#ebix-email-err").text("")}),1e4)}))}));const{referral_rule:a,referral_history:s,referral_illigible:d}=n;if(a.length>0){e(a,"ebix-ref-reward",ebix_Promotion.CustomerId&&!d);const t=a[0]?.award||"";$("#refer-friend #whatsapp").attr("href",encodeURI(`https://api.whatsapp.com/send?text=${window.shopUrl} \nSignup with code: ${n.invite_code} \nto ${t}`))}(a.length>0||s.length>0||null!=n.reward)&&$("#ebix-embeded-btn").css("display","flex"),ebix_Promotion.CustomerId&&(a.length>0||s.length>0)&&($("#ebix-referral-card").css("display","block"),$("#ebix-referral-card").show()),d&&($("#ebix-join-referral").show(),$("#ebix-join-referral").click((t=>{$("#ebix-custom-prompt").show(),$("#ebix-referral-code-input").val(""),$("#ebix-confirm-referral").off().on("click",(function(){const t=$("#ebix-referral-code-input").val();if($("#ebix-custom-prompt").hide(),t){let n=$("#ebix-join-referral").text();$("#ebix-join-referral").text("Loading..."),$("#ebix-join-referral").prop("disabled",!0),fetch("/apps/shopify/register_referral",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,code:t}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((t=>t.json())).then((t=>{$("#ebix-join-referral").text(n),$("#ebix-join-referral").prop("disabled",!1),$("#ebix-ref-err").html(""),0==t.code?($("#ebix-referral-card").hide(),$("#ebix-join-referral").hide(),$("#ebix-redeem-point").hide(),r()):$("#ebix-ref-err").html(`<p style="color:red">${t.msg}</p>`)})).catch((t=>{$("#ebix-join-referral").text(n),$("#ebix-join-referral").prop("disabled",!1)}))}})),$("#ebix-cancel-referral").off().on("click",(function(){$("#ebix-custom-prompt").hide()}))}))),a.length>0&&e(a,"ebix-ref-reward",ebix_Promotion.CustomerId&&!d),s.length>0&&function(t,n){if(t&&t.length>0){var a="<p><b>From Referrals</b><p>You can get rewards when your recommended friends complete tasks</p></p>";a+="<table class='table'>",a+="<tr><th>Referral No</th><th>Recipient email</th><th>Date</th><th>Status</th><th>Rewards</th></tr>",t.forEach(((t,n)=>{t.referral_no&&t.email&&t.date&&t.status&&t.reward&&(a+="<tr>",a+=`<td>${t.referral_no}</td>`,a+=`<td>${t.email}</td>`,a+=`<td>${t.date}</td>`,a+=`<td>${t.status}</td>`,a+=`<td>${t.reward}</td>`,a+="</tr>")})),a+="</table>",$(".ebix-modal #ebix-ref-history").html(a)}}(s,0,ebix_Promotion.CustomerId)}})).catch((t=>{}))}(),$(".ebix-embeded-close-btn").click((t=>{t.stopPropagation(),$("#ebix-embeded-btn").css("display","none"),function(t,n,a){const s=new Date;s.setTime(s.getTime()+864e5);let d="expires="+s.toUTCString();document.cookie="ebix-embeded-closed=true;"+d+";path=/"}()})),$("#ebix-embeded-btn").click((t=>{$(".ebix-modal").toggleClass("show")})),$(".ebix-modal-close").click((t=>{$(".ebix-modal").toggleClass("show")})),$(".ebix-modal-content").click((t=>{t.stopPropagation()})),$(".ebix-modal").click((t=>{$(".ebix-modal").toggleClass("show")}));var n=null;$("#ebix-cpy-ref-code").click((t=>{i("#ebix-pro-ref-code"),n&&clearTimeout(n),$("#ebix-cpy-ref-code").text("Copied!"),n=setTimeout((()=>$("#ebix-cpy-ref-code").text("Copy")),5e3)}));var a=null;$("#ebix-cpy-redeem-code").click((t=>{i("#ebix-redeem-coupon"),a&&clearTimeout(a),a=$("#ebix-cpy-redeem-code").text("Copied!"),setTimeout((()=>$("#ebix-cpy-redeem-code").text("Copy")),5e3)})),function(){const t=window.fetch;window.fetch=async function(n,a){const s="string"==typeof n?n:n?.url||"",d=await t(n,a);return(s.includes("/cart/change")||s.includes("/cart/update")||s.includes("/cart/add"))&&d.clone().json().then((()=>f())),d}}(),document.addEventListener("DOMContentLoaded",(function(){f(),new MutationObserver((()=>{c.length>0&&setTimeout((()=>p(c)),100)})).observe(document.body,{childList:!0,subtree:!0})})),window.addEventListener("pageshow",(()=>f()));const s=["check out","proceed"];let d=new Set,c=[];function l(t){const n=document.querySelector("#drawer-offers-template .drawer-offers-block");if(!n)return console.warn("Offer template missing"),null;const a=n.cloneNode(!0);a.setAttribute("data-injected","true"),a.setAttribute("data-offer-id",t.rule.promotion_id||t.rule.rule_id);const s=a.querySelector(".offer-text"),d=a.querySelector(".offer-label");return s&&(s.textContent=t.offer_message),d&&(d.textContent=t.offer_type_name||"OFFER"),a}function p(t){const n=document.querySelectorAll("button, a");document.querySelectorAll('.drawer-offers-block[data-injected="true"]').forEach((t=>t.remove())),n.forEach((n=>{if(function(t){const n=(t.innerText||"").toLowerCase();return s.some((t=>n.includes(t)))}(n)&&null!==n.offsetParent){const a=n.parentNode;t.forEach((t=>{const s=t.rule.promotion_id||t.rule.rule_id;if(!d.has(s)){const c=l(t);c&&(a.insertBefore(c,n),d.add(s))}}))}}));const a=document.getElementById("drawer-offers-list");a&&(a.style.display="none")}function f(t=0){const n=window.ebix_Promotion,a=window.Shopify?.currency?.active||null;fetch(window.Shopify.routes.root+"cart.js").then((t=>t.json())).then((t=>{const s={user_id:n.CustomerId||null,shop_id:n.ShopId||null,terminal:"web",country_id:["1"],currency:a,coupon_code:"",items:t.items};return d.clear(),fetch("/apps/shopify/non_applied_offer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})})).then((t=>t.json())).then((t=>{200===t.status&&Array.isArray(t.data)&&0===t.code?(c=t.data,function(t){const n=document.getElementById("drawer-offers-list"),a=document.querySelector("#drawer-offers-template .drawer-offers-block");n&&a?(n.innerHTML="",t.forEach((t=>{const a=l(t);a&&n.appendChild(a)})),n.style.display="block"):console.warn("Drawer elements missing")}(c),setTimeout((()=>p(c)),300)):console.warn("No offers returned or response invalid")})).catch((n=>{console.error("Error fetching offers:",n),t<3&&setTimeout((()=>f(t+1)),1e3)}))}!function(t){const n=window.ebix_Promotion;if(!n?.ShopId)return void console.warn("ShopId not found in ebix_Promotion");const a=document.querySelector('form[action^="/cart/add"] input[name="id"]'),s=(a?a.value:null)||void 0,d=JSON.stringify({customer_id:n.CustomerId,shopify_shop_id:n.ShopId,variant_id:s});fetch("/apps/shopify/promotion_list",{method:"POST",body:d,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((t=>t.json())).then((t=>{const n=document.getElementById("Promotion-List"),a=n.querySelector(".Promotion-List-block"),s=n.querySelector(".Promotion-List-offer-box");a.innerHTML="",200===t.status&&0===t.code&&Array.isArray(t.data)&&(t.data.forEach((t=>{if(t.offer_message&&""!==t.offer_message.trim()&&t.offer_type&&""!==t.offer_type.trim()){const n=s.cloneNode(!0),d=n.querySelector(".Promotion-List-offer-text"),c=n.querySelector(".Promotion-List-offer-label");d?d.textContent=t.offer_message:console.error("Missing .Promotion-List-offer-text in clone"),c?c.textContent=t.offer_type:console.error("Missing .Promotion-List-offer-label in clone"),a.appendChild(n)}})),a.children.length>0&&(n.style.display="block"))})).catch((t=>{console.error("Error fetching special price:",t),document.getElementById("Promotion-List").style.display="none"}))}()};