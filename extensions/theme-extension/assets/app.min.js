window.onload=()=>{function a(e,t,i=!1){e&&0<e.length&&(n=(n="<table class='table'>")+"<tr><th></th><th>Tasks</th><th>Awards</th>"+(i?"<th>Expiry</th></tr>":"</tr>"),e.map(o=>{o.rules.map((e,t)=>{n+="<tr>";var r=ebix_referral_img3;"Register"==e.attribute_operation?r=ebix_referral_img1:"visit_page"==e.attribute_operation&&(r=ebix_referral_img2),n=(n+=`<td><img src="${r}" width="26" alt="${e.attribute_operation}"/></td>`)+`<td>${e.task}</td>`,0==t&&(n+=`<td rowspan="${o.rules.length}">${o.award}</td>`,i)&&(n+=e.is_rule_passed?`<td rowspan="${o.rules.length}" style="font-size: 2rem;color: green;">âœ“</td>`:e.expiry_status?`<td rowspan="${o.rules.length}" style="color: red;>${e.expiry_date} Expired</td>`:`<td rowspan="${o.rules.length}">${e.expiry_date}</td>`),n+="</tr>"})}),n+="</table>",$("#"+t).html(n));var n,e=$(".ebix-modal #specific-link");e.append("<svg fill='currentColor' style='margin-left: 3px' width='15' height='15' viewBox='0 0 15 15' xmlns='http://www.w3.org/2000/svg'><path d='M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z' fill='currentColor' fill-rule='evenodd' clip-rule='evenodd'></path></svg>"),e.click(function(){var e=$(this).attr("ref-id"),t=$(this).attr("ref-rule-id");let r=$(this).attr("href"),o=$(this).html();$(this).html("Loading..."),t&&e&&(e=JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,ref_row_id:e,ref_rule_id:t}),fetch("/apps/shopify/referral_visit",{method:"POST",body:e,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then(e=>e.json()).then(e=>{$(this).html(o),window.location.href=r}).catch(e=>{$(this).html(o),window.location.href=r}))})}const r=EventTarget.prototype.dispatchEvent;function o(e){(t=window.location.pathname.match(/^\/products\/([\w-]+)/))&&t[1];var t=document.querySelector('form[action^="/cart/add"] input[name="id"]'),t=(t?t.value:null)||e;ebix_Promotion.ShopId&&(e=JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,variant_id:t}),fetch("/apps/shopify/get_special_price",{method:"POST",body:e,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then(e=>e.json()).then(e=>{e=e?.data?.data;Array.isArray(e)&&0<e.length?(e.forEach(e=>{var t=e?.eff?.variants?.[0]?.discount_price,e=parseFloat(e?.eff?.variants?.[0]?.unit_price||0).toFixed(2);$("#spl-price").text(t),$("#unit-price").text(e)}),$("#custom-offer-widget").css("display","block")):$("#custom-offer-widget").css("display","none")}).catch(e=>{console.error("Error fetching special price:",e),$("#custom-offer-widget").css("display","none")}))}function s(){ebix_Promotion.ShopId&&fetch("/apps/shopify/loyalty",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then(e=>e.json()).then(e=>{var t,r,o,i,n;e.data&&({referral_rule:t,referral_history:r,referral_illigible:o}=((e=e.data).membership&&$("#ebix-tier").text(e.membership.name||"-"),$("#ebix-points").text(e.active_pts||0),e.reward&&($("#ebix-loyalty-card").css("display","block"),$("#ebix-reward").html(`${e.currency} ${e.reward.amount} = ${e.reward.points} Point`)),e.redeem&&($("#ebix-loyalty-card").css("display","block"),$("#ebix-redeem").html(`${e.redeem.points} Point = ${e.currency} `+e.redeem.amount)),e.redeem&&e.redeem.max_pts&&(e.redeem&&($("#ebix-max-point").text(e.redeem.max_pts||0),$("#ebix-redeem-coupon").text(e.redeem_code||"")),$("#ebix-redeem-point").show(),$("#total-redeemable").text(`(${e.currency} ${e.redeem.amount/e.redeem.points*e.redeem?.max_pts})`)),$("#ebix-pro-ref-code").text(e.invite_code||""),$("#refer-friend #facebook").attr("href",encodeURI(`https://www.facebook.com/sharer/sharer.php?u=${window.shopUrl}&t=Register and use this code: `+e.invite_code)),$("#refer-friend #email").click(e=>{var t=(t=prompt("Enter invitation emails:")).split(",").map(e=>e.trim()),r=($("#ebix-email-err").text(""),0);t.forEach(e=>{/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)||($("#ebix-email-err").append(`<p style="color:red">${e}: Invalid email.</p>`),r++)}),0==r&&fetch("/apps/shopify/email_invite",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,emails:t}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then(e=>e.json()).then(e=>{e.data&&(e.data.already_invited_emails&&0<e.data.already_invited_emails.length?$("#ebix-email-err").append(`<p style="color:red">${e.data.already_invited_emails.join(",")} ${e.msg}</p>`):$("#ebix-email-err").append(`<p style="color:green">${e.msg}</p>`)),setTimeout(()=>{$("#ebix-email-err").text("")},1e4)})}),e),0<t.length&&(a(t,"ebix-ref-reward",ebix_Promotion.CustomerId&&!o),i=t[0]?.award||"",$("#refer-friend #whatsapp").attr("href",encodeURI(`https://api.whatsapp.com/send?text=${window.shopUrl} 
Signup with code: ${e.invite_code} 
to `+i))),(0<t.length||0<r.length||null!=e.reward)&&$("#ebix-embeded-btn").css("display","flex"),ebix_Promotion.CustomerId&&(0<t.length||0<r.length)&&($("#ebix-referral-card").css("display","block"),$("#ebix-referral-card").show()),o&&($("#ebix-join-referral").show(),$("#ebix-join-referral").click(e=>{$("#ebix-custom-prompt").show(),$("#ebix-referral-code-input").val(""),$("#ebix-confirm-referral").off().on("click",function(){var e=$("#ebix-referral-code-input").val();if($("#ebix-custom-prompt").hide(),e){let t=$("#ebix-join-referral").text();$("#ebix-join-referral").text("Loading..."),$("#ebix-join-referral").prop("disabled",!0),fetch("/apps/shopify/register_referral",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,code:e}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then(e=>e.json()).then(e=>{$("#ebix-join-referral").text(t),$("#ebix-join-referral").prop("disabled",!1),$("#ebix-ref-err").html(""),0==e.code?($("#ebix-referral-card").hide(),$("#ebix-join-referral").hide(),$("#ebix-redeem-point").hide(),s()):$("#ebix-ref-err").html(`<p style="color:red">${e.msg}</p>`)}).catch(e=>{$("#ebix-join-referral").text(t),$("#ebix-join-referral").prop("disabled",!1)})}}),$("#ebix-cancel-referral").off().on("click",function(){$("#ebix-custom-prompt").hide()})})),0<t.length&&a(t,"ebix-ref-reward",ebix_Promotion.CustomerId&&!o),0<r.length)&&(i="ebix-ref-history",e=r)&&0<e.length&&(n="<p><b>From Referrals</b></p><table class='table'><tr><th>Referral No</th><th>Recipient email</th><th>Date</th><th>Status</th><th>Rewards</th></tr>",e.forEach((e,t)=>{e.referral_no&&e.email&&e.date&&e.status&&e.reward&&(n=(n=(n=(n=(n=(n+="<tr>")+`<td>${e.referral_no}</td>`)+`<td>${e.email}</td>`)+`<td>${e.date}</td>`)+`<td>${e.status}</td>`)+`<td>${e.reward}</td>`+"</tr>")}),n+="</table>",$(".ebix-modal #"+i).html(n))}).catch(e=>{})}function t(e){e=$(e).text();navigator.clipboard.writeText(e)}EventTarget.prototype.dispatchEvent=function(e){var e=r.call(this,e),t=document.querySelectorAll('form[action^="/cart/add"] input[name="id"]'),t=t[t.length-1];return t&&o(t.value),e},o(),$("#ebix-referral-card").hide(),$("#ebix-join-referral").hide(),$("#ebix-redeem-point").hide(),!function(e){var r=e+"=",o=decodeURIComponent(document.cookie).split(";");for(let t=0;t<o.length;t++){let e=o[t];for(;" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(r))return e.substring(r.length,e.length)}}("ebix-embeded-closed")?"undefined"!=typeof ebix_Promotion&&ebix_Promotion.ShopId&&s():$("#ebix-embeded-btn").css("display","none"),$(".ebix-embeded-close-btn").click(e=>{var t,r,o;e.stopPropagation(),$("#ebix-embeded-btn").css("display","none"),e="ebix-embeded-closed",t=!0,r=24,(o=new Date).setTime(o.getTime()+60*r*60*1e3),r="expires="+o.toUTCString(),document.cookie=e+"="+t+";"+r+";path=/"}),$("#ebix-embeded-btn").click(e=>{$(".ebix-modal").toggleClass("show")}),$(".ebix-modal-close").click(e=>{$(".ebix-modal").toggleClass("show")}),$(".ebix-modal-content").click(e=>{e.stopPropagation()}),$(".ebix-modal").click(e=>{$(".ebix-modal").toggleClass("show")});var e,i,n,d=null,l=($("#ebix-cpy-ref-code").click(e=>{t("#ebix-pro-ref-code"),d&&clearTimeout(d),$("#ebix-cpy-ref-code").text("Copied!"),d=setTimeout(()=>$("#ebix-cpy-ref-code").text("Copy"),5e3)}),null);$("#ebix-cpy-redeem-code").click(e=>{t("#ebix-redeem-coupon"),l&&clearTimeout(l),l=$("#ebix-cpy-redeem-code").text("Copied!"),setTimeout(()=>$("#ebix-cpy-redeem-code").text("Copy"),5e3)});{const b=window.fetch;window.fetch=async function(e,t){var r="string"==typeof e?e:e?.url||"",e=await b(e,t);return(r.includes("/cart/change")||r.includes("/cart/update")||r.includes("/cart/add"))&&e.clone().json().then(()=>u()),e}}document.addEventListener("DOMContentLoaded",function(){u(),function(){var e=new MutationObserver(()=>{0<m.length&&setTimeout(()=>h(m),100)});e.observe(document.body,{childList:!0,subtree:!0})}()}),window.addEventListener("pageshow",()=>u());const c=["check out","proceed"];let p=new Set,m=[];function f(e){var t,r,o=document.querySelector("#drawer-offers-template .drawer-offers-block");return o?((o=o.cloneNode(!0)).setAttribute("data-injected","true"),o.setAttribute("data-offer-id",e.rule.promotion_id||e.rule.rule_id),t=o.querySelector(".offer-text"),r=o.querySelector(".offer-label"),t&&(t.textContent=e.offer_message),r&&(r.textContent=e.offer_type_name||"OFFER"),o):(console.warn("Offer template missing"),null)}function h(e){var t=document.querySelectorAll("button, a"),t=(document.querySelectorAll('.drawer-offers-block[data-injected="true"]').forEach(e=>e.remove()),t.forEach(r=>{if(function(e){const t=(e.innerText||"").toLowerCase();return c.some(e=>t.includes(e))}(r)&&null!==r.offsetParent){const o=r.parentNode;e.forEach(e=>{var t=e.rule.promotion_id||e.rule.rule_id;p.has(t)||(e=f(e))&&(o.insertBefore(e,r),p.add(t))})}}),document.getElementById("drawer-offers-list"));t&&(t.style.display="none")}function u(t=0){const r=window.ebix_Promotion;r?.CustomerId&&r?.ShopId?fetch(window.Shopify.routes.root+"cart.js").then(e=>e.json()).then(e=>{e={user_id:r.CustomerId,shop_id:r.ShopId,terminal:"web",country_id:["1"],coupon_code:"",items:e.items};return p.clear(),fetch("/apps/shopify/non_applied_offer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}).then(e=>e.json()).then(e=>{if(200===e.status&&Array.isArray(e.data)&&0===e.code){m=e.data;{e=m;const r=document.getElementById("drawer-offers-list");var t=document.querySelector("#drawer-offers-template .drawer-offers-block");r&&t?(r.innerHTML="",e.forEach(e=>{e=f(e);e&&r.appendChild(e)}),r.style.display="block"):console.warn("Drawer elements missing")}setTimeout(()=>h(m),300)}else console.warn("No offers returned or response invalid")}).catch(e=>{console.error("Error fetching offers:",e),t<3&&setTimeout(()=>u(t+1),1e3)}):console.warn("CustomerId or ShopId missing in ebix_Promotion")}(n=window.ebix_Promotion)?.ShopId?(i=(i=document.querySelector('form[action^="/cart/add"] input[name="id"]'))?i.value:null,n=JSON.stringify({customer_id:n.CustomerId,shopify_shop_id:n.ShopId,variant_id:i||e}),fetch("/apps/shopify/promotion_list",{method:"POST",body:n,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then(e=>e.json()).then(e=>{var t=document.getElementById("Promotion-List");const i=t.querySelector(".Promotion-List-block"),n=t.querySelector(".Promotion-List-offer-box");i.innerHTML="",200===e.status&&0===e.code&&Array.isArray(e.data)&&(e.data.forEach(e=>{var t,r,o;e.offer_message&&""!==e.offer_message.trim()&&e.offer_type&&""!==e.offer_type.trim()&&(r=(t=n.cloneNode(!0)).querySelector(".Promotion-List-offer-text"),o=t.querySelector(".Promotion-List-offer-label"),r?r.textContent=e.offer_message:console.error("Missing .Promotion-List-offer-text in clone"),o?o.textContent=e.offer_type:console.error("Missing .Promotion-List-offer-label in clone"),i.appendChild(t))}),0<i.children.length)&&(t.style.display="block")}).catch(e=>{console.error("Error fetching special price:",e),document.getElementById("Promotion-List").style.display="none"})):console.warn("ShopId not found in ebix_Promotion")};