window.onload=()=>{function e(e,t,o=!1){e&&e.length>0&&$(`.${t}`).each((function(){const t=$(this).attr("id");let r="<table class='table'>",i="<tr><th></th><th>Referee (New member) Tasks</th><th>Awards</th>";"reward_only"===t&&(i="<tr><th></th><th>Tasks</th><th>Awards</th>"),r+=i,r+=o?"<th>Get</th></tr>":"</tr>",e.forEach((e=>{e.rules.forEach(((t,i)=>{r+="<tr>";let n=ebix_referral_img3;"Register"===t.attribute_operation?n=ebix_referral_img1:"visit_page"===t.attribute_operation&&(n=ebix_referral_img2),r+=`<td><img src="${n}" width="26" alt="${t.attribute_operation}"/></td>`,r+=`<td>${t.task}</td>`,0===i&&(r+=`<td rowspan="${e.rules.length}">${e.award}</td>`,o&&(t.is_rule_passed?r+=`<td rowspan="${e.rules.length}" style="font-size: 2rem;color: green;">âœ“</td>`:t.expiry_status?r+=`<td rowspan="${e.rules.length}" style="color: red;">${t.expiry_date} Expired</td>`:r+=`<td rowspan="${e.rules.length}">${t.expiry_date}</td>`)),r+="</tr>"}))})),r+="</table>",$(this).html(r)}));const r=$(".ebix-modal #specific-link");r.append("<svg fill='currentColor' style='margin-left: 3px' width='15' height='15' viewBox='0 0 15 15' xmlns='http://www.w3.org/2000/svg'><path d='M3 2C2.44772 2 2 2.44772 2 3V12C2 12.5523 2.44772 13 3 13H12C12.5523 13 13 12.5523 13 12V8.5C13 8.22386 12.7761 8 12.5 8C12.2239 8 12 8.22386 12 8.5V12H3V3L6.5 3C6.77614 3 7 2.77614 7 2.5C7 2.22386 6.77614 2 6.5 2H3ZM12.8536 2.14645C12.9015 2.19439 12.9377 2.24964 12.9621 2.30861C12.9861 2.36669 12.9996 2.4303 13 2.497L13 2.5V2.50049V5.5C13 5.77614 12.7761 6 12.5 6C12.2239 6 12 5.77614 12 5.5V3.70711L6.85355 8.85355C6.65829 9.04882 6.34171 9.04882 6.14645 8.85355C5.95118 8.65829 5.95118 8.34171 6.14645 8.14645L11.2929 3H9.5C9.22386 3 9 2.77614 9 2.5C9 2.22386 9.22386 2 9.5 2H12.4999H12.5C12.5678 2 12.6324 2.01349 12.6914 2.03794C12.7504 2.06234 12.8056 2.09851 12.8536 2.14645Z' fill='currentColor' fill-rule='evenodd' clip-rule='evenodd'></path></svg>"),r.click((function(){let e=$(this).attr("ref-id"),t=$(this).attr("ref-rule-id"),o=$(this).attr("href"),r=$(this).html();if($(this).html("Loading..."),t&&e){const i=JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,ref_row_id:e,ref_rule_id:t});fetch("/apps/shopify/referral_visit",{method:"POST",body:i,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((e=>e.json())).then((e=>{$(this).html(r),window.location.href=o})).catch((e=>{$(this).html(r),window.location.href=o}))}}))}const t=EventTarget.prototype.dispatchEvent;function o(e){!function(){const e=window.location.pathname.match(/^\/products\/([\w-]+)/);e&&e[1]}();const t=document.querySelector('form[action^="/cart/add"] input[name="id"]'),o=(t?t.value:null)||e;if(!ebix_Promotion.ShopId)return;const r=JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,variant_id:o});fetch("/apps/shopify/get_special_price",{method:"POST",body:r,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((e=>e.json())).then((e=>{const t=e?.data?.data;Array.isArray(t)&&t.length>0?(t.forEach((e=>{const t=e?.eff?.variants?.[0]?.discount_price,o=parseFloat(e?.eff?.variants?.[0]?.unit_price||0).toFixed(2);$("#spl-price").text(t),$("#unit-price").text(o)})),$("#custom-offer-widget").css("display","block")):$("#custom-offer-widget").css("display","none")})).catch((e=>{console.error("Error fetching special price:",e),$("#custom-offer-widget").css("display","none")}))}function r(){ebix_Promotion.ShopId&&fetch("/apps/shopify/loyalty",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((e=>e.json())).then((t=>{if(t.data){const o=t.data;o.membership&&$("#ebix-tier").text(o.membership.name||"-"),$("#ebix-points").text(o.active_pts||0),o.reward&&($("#ebix-loyalty-card").css("display","block"),$("#ebix-reward").html(`${o.currency} ${o.reward.amount} = ${o.reward.points} Point`)),o.redeem&&($("#ebix-loyalty-card").css("display","block"),$("#ebix-redeem").html(`${o.redeem.points} Point = ${o.currency} ${o.redeem.amount}`)),o.redeem&&o.redeem.max_pts&&(o.redeem&&($("#ebix-max-point").text(o.redeem.max_pts||0),$("#ebix-redeem-coupon").text(o.redeem_code||"")),$("#ebix-redeem-point").show(),$("#total-redeemable").text(`(${o.currency} ${o.redeem.amount/o.redeem.points*o.redeem?.max_pts})`)),$("#ebix-pro-ref-code").text(o.invite_code||""),$("#refer-friend #facebook").attr("href",encodeURI(`https://www.facebook.com/sharer/sharer.php?u=${window.shopUrl}&t=Register and use this code: ${o.invite_code}`)),$("#refer-friend #email").click((e=>{var t=prompt("Enter invitation emails:");t=t.split(",").map((e=>e.trim())),$("#ebix-email-err").text("");var o=0;t.forEach((e=>{(function(e){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)})(e)||($("#ebix-email-err").append(`<p style="color:red">${e}: Invalid email.</p>`),o++)})),0==o&&fetch("/apps/shopify/email_invite",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,emails:t}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((e=>e.json())).then((e=>{e.data&&(e.data.already_invited_emails&&e.data.already_invited_emails.length>0?$("#ebix-email-err").append(`<p style="color:red">${e.data.already_invited_emails.join(",")} ${e.msg}</p>`):$("#ebix-email-err").append(`<p style="color:green">${e.msg}</p>`)),setTimeout((()=>{$("#ebix-email-err").text("")}),1e4)}))}));const{referral_rule:i,referral_history:n,referral_illigible:a}=o;if(i.length>0){e(i,"ebix-ref-reward",ebix_Promotion.CustomerId&&!a);const t=i[0]?.award||"";$("#refer-friend #whatsapp").attr("href",encodeURI(`https://api.whatsapp.com/send?text=${window.shopUrl} \nSignup with code: ${o.invite_code} \nto ${t}`))}(i.length>0||n.length>0||null!=o.reward)&&$("#ebix-embeded-btn").css("display","flex"),ebix_Promotion.CustomerId&&(i.length>0||n.length>0)&&($("#ebix-referral-card").css("display","block"),$("#ebix-referral-card").show()),a&&($("#ebix-join-referral").show(),$("#ebix-join-referral").click((e=>{$("#ebix-custom-prompt").show(),$("#ebix-referral-code-input").val(""),$("#ebix-confirm-referral").off().on("click",(function(){const e=$("#ebix-referral-code-input").val();if($("#ebix-custom-prompt").hide(),e){let t=$("#ebix-join-referral").text();$("#ebix-join-referral").text("Loading..."),$("#ebix-join-referral").prop("disabled",!0),fetch("/apps/shopify/register_referral",{method:"POST",body:JSON.stringify({customer_id:ebix_Promotion.CustomerId,shopify_shop_id:ebix_Promotion.ShopId,code:e}),headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((e=>e.json())).then((e=>{$("#ebix-join-referral").text(t),$("#ebix-join-referral").prop("disabled",!1),$("#ebix-ref-err").html(""),0==e.code?($("#ebix-referral-card").hide(),$("#ebix-join-referral").hide(),$("#ebix-redeem-point").hide(),r()):$("#ebix-ref-err").html(`<p style="color:red">${e.msg}</p>`)})).catch((e=>{$("#ebix-join-referral").text(t),$("#ebix-join-referral").prop("disabled",!1)}))}})),$("#ebix-cancel-referral").off().on("click",(function(){$("#ebix-custom-prompt").hide()}))}))),i.length>0&&e(i,"ebix-ref-reward",ebix_Promotion.CustomerId&&!a),n.length>0&&function(e,t){if(e&&e.length>0){var o="<p><b>From Referrals</b><p>You can get rewards when your recommended friends complete tasks</p></p>";o+="<table class='table'>",o+="<tr><th>Referral No</th><th>Recipient email</th><th>Date</th><th>Status</th><th>Rewards</th></tr>",e.forEach(((e,t)=>{e.referral_no&&e.email&&e.date&&e.status&&e.reward&&(o+="<tr>",o+=`<td>${e.referral_no}</td>`,o+=`<td>${e.email}</td>`,o+=`<td>${e.date}</td>`,o+=`<td>${e.status}</td>`,o+=`<td>${e.reward}</td>`,o+="</tr>")})),o+="</table>",$(`.ebix-modal #${t}`).html(o)}}(n,"ebix-ref-history",ebix_Promotion.CustomerId)}})).catch((e=>{}))}function i(e){var t=$(e).text();navigator.clipboard.writeText(t)}EventTarget.prototype.dispatchEvent=function(e){const r=t.call(this,e),i=document.querySelectorAll('form[action^="/cart/add"] input[name="id"]'),n=i[i.length-1];return n&&o(n.value),r},o(),$("#ebix-referral-card").hide(),$("#ebix-join-referral").hide(),$("#ebix-redeem-point").hide(),!function(e){let t=e+"=",o=decodeURIComponent(document.cookie).split(";");for(let e=0;e<o.length;e++){let r=o[e];for(;" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}("ebix-embeded-closed")?"undefined"!=typeof ebix_Promotion&&ebix_Promotion.ShopId&&r():$("#ebix-embeded-btn").css("display","none"),$(".ebix-embeded-close-btn").click((e=>{e.stopPropagation(),$("#ebix-embeded-btn").css("display","none")})),$("#ebix-embeded-btn").click((e=>{$(".ebix-modal").toggleClass("show")})),$(".ebix-modal-close").click((e=>{$(".ebix-modal").toggleClass("show")})),$(".ebix-modal-content").click((e=>{e.stopPropagation()})),$(".ebix-modal").click((e=>{$(".ebix-modal").toggleClass("show")}));var n=null;$("#ebix-cpy-ref-code").click((e=>{i("#ebix-pro-ref-code"),n&&clearTimeout(n),$("#ebix-cpy-ref-code").text("Copied!"),n=setTimeout((()=>$("#ebix-cpy-ref-code").text("Copy")),5e3)}));var a=null;$("#ebix-cpy-redeem-code").click((e=>{i("#ebix-redeem-coupon"),a&&clearTimeout(a),a=$("#ebix-cpy-redeem-code").text("Copied!"),setTimeout((()=>$("#ebix-cpy-redeem-code").text("Copy")),5e3)})),function(){const e=window.fetch;window.fetch=async function(t,o){const r="string"==typeof t?t:t?.url||"",i=await e(t,o);return(r.includes("/cart/change")||r.includes("/cart/update")||r.includes("/cart/add"))&&i.clone().json().then((()=>f())),i}}(),document.addEventListener("DOMContentLoaded",(function(){f(),new MutationObserver((()=>{l.length>0&&setTimeout((()=>p(l)),100)})).observe(document.body,{childList:!0,subtree:!0})})),window.addEventListener("pageshow",(()=>f()));const s=["check out","proceed"];let d=new Set,l=[];function c(e){const t=document.querySelector("#drawer-offers-template .drawer-offers-block");if(!t)return console.warn("Offer template missing"),null;const o=t.cloneNode(!0);o.setAttribute("data-injected","true"),o.setAttribute("data-offer-id",e.rule.promotion_id||e.rule.rule_id);const r=o.querySelector(".offer-text"),i=o.querySelector(".offer-label");return r&&(r.textContent=e.offer_message),i&&(i.textContent=e.offer_type_name||"OFFER"),o}function p(e){const t=document.querySelectorAll("button, a");document.querySelectorAll('.drawer-offers-block[data-injected="true"]').forEach((e=>e.remove())),t.forEach((t=>{if(function(e){const t=(e.innerText||"").toLowerCase();return s.some((e=>t.includes(e)))}(t)&&null!==t.offsetParent){const o=t.parentNode;e.forEach((e=>{const r=e.rule.promotion_id||e.rule.rule_id;if(!d.has(r)){const i=c(e);i&&(o.insertBefore(i,t),d.add(r))}}))}}));const o=document.getElementById("drawer-offers-list");o&&(o.style.display="none")}function f(e=0){const t=window.ebix_Promotion,o=window.Shopify?.currency?.active||null;fetch(window.Shopify.routes.root+"cart.js").then((e=>e.json())).then((e=>{const r={user_id:t.CustomerId||null,shop_id:t.ShopId||null,terminal:"web",country_id:["1"],currency:o,coupon_code:"",items:e.items};return d.clear(),fetch("/apps/shopify/non_applied_offer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})})).then((e=>e.json())).then((e=>{200===e.status&&Array.isArray(e.data)&&0===e.code?(l=e.data,function(e){const t=document.getElementById("drawer-offers-list"),o=document.querySelector("#drawer-offers-template .drawer-offers-block");t&&o?(t.innerHTML="",e.forEach((e=>{const o=c(e);o&&t.appendChild(o)})),t.style.display="block"):console.warn("Drawer elements missing")}(l),setTimeout((()=>p(l)),300)):console.warn("No offers returned or response invalid")})).catch((t=>{console.error("Error fetching offers:",t),e<3&&setTimeout((()=>f(e+1)),1e3)}))}!function(e){const t=window.ebix_Promotion;if(!t?.ShopId)return void console.warn("ShopId not found in ebix_Promotion");const o=document.querySelector('form[action^="/cart/add"] input[name="id"]'),r=(o?o.value:null)||e,i=JSON.stringify({customer_id:t.CustomerId,shopify_shop_id:t.ShopId,variant_id:r});fetch("/apps/shopify/promotion_list",{method:"POST",body:i,headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"true","Sys-Language":"en"}}).then((e=>e.json())).then((e=>{const t=document.getElementById("Promotion-List"),o=t.querySelector(".Promotion-List-block"),r=t.querySelector(".Promotion-List-offer-box");o.innerHTML="",200===e.status&&0===e.code&&Array.isArray(e.data)&&(e.data.forEach((e=>{if(e.offer_message&&""!==e.offer_message.trim()&&e.offer_type&&""!==e.offer_type.trim()){const t=r.cloneNode(!0),i=t.querySelector(".Promotion-List-offer-text"),n=t.querySelector(".Promotion-List-offer-label");i?i.textContent=e.offer_message:console.error("Missing .Promotion-List-offer-text in clone"),n?n.textContent=e.offer_type:console.error("Missing .Promotion-List-offer-label in clone"),o.appendChild(t)}})),o.children.length>0&&(t.style.display="block"))})).catch((e=>{console.error("Error fetching special price:",e),document.getElementById("Promotion-List").style.display="none"}))}()};